   <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
 
   <!--  summary -->
<div id="summary"
     style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; cursor: not-allowed; opacity: 0.6;">
  <h4>Summary of Latest Articles</h4>
  <p id="summary-content">Summary will be available shortly‚Ä¶</p>
</div>


     <h4> Trend </h4>
<!-- Where trend summary content goes -->
<div id="trendSummary" style="margin-top: 10px;"></div>
<ul id="dailySummaries" style="margin-top: 10px; line-height: 1.5;"></ul>
      
   
   <title>üåç Dashboard</title>
   <p> Scoring <i>(from 1 neutral to 3 good read)</i> is using GPT4o-mini and news comes from RSS feeds. 
   </p> 

   
  <!-- Google tag (gtag.js) -->
   <script async src="https://www.googletagmanager.com/gtag/js?id=G-VN5C4XB6K1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VN5C4XB6K1');
</script> 
   
  
   <style>
   body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      max-width: 960px;
      margin: 40px auto;
    }
    h3, h4 {
      text-align: center;
      color: #222;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #007acc;
      color: #fff;
    }
    tr.positive { background-color: ##f2f2f2; }
    tr.negative { background-color: #D3D3D3; }
    tr.neutral  { background-color: #FCFCF7; }
    .btn-preview {
      padding: 4px 8px;
      font-size: 12px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 5px;
      cursor: pointer;
    }
    .btn-preview:hover {
      background-color: #005c8c;
    }
    .preview-row {
      display: none;
      background-color: #eef6ff;
    }
    .preview-content {
      padding: 10px;
    }
    
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!--  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.2/src/wordcloud2.min.js"></script> --> 
   
 <!-- Hidden clickable pixel -->
   <div onclick="alert('‚ÄúI told my LLM to ‚Äòthink outside the box‚Äô‚Ä¶ it asked me for the dimensions of the box and whether it was in JSON or YAML')" 
     style="position: absolute; top: 0; left: 0; width: 10px; height: 10px; opacity: 1; cursor: pointer;">
   </div>
</head>

   <body>

  <h3> Dashboard</h3>
   <div id="loading">üîÑ Loading data...</div>
<button id="toggleSort" class="btn-preview">‚¨ÜÔ∏è Sort by Date</button>




  <!--
  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; align-items:flex-start; width:100%;">
  <style>
    #countryCard {
      text-align:center;
      margin:0 auto;
      max-width:520px;
    }
    #countryToggle {
      position:absolute;
      left:-9999px;
    }
    #countryCard .toggle-btn {
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      border:none;
      background:transparent;
      font:inherit;
      cursor:pointer;
      font-weight:600;
      padding:4px 0;
    }
    #countryCard .chev {
      display:inline-block;
      transition: transform .2s ease;
    }
    #countryToggle:checked + .toggle-btn .chev {
      transform: rotate(90deg);
    }
    #countryCard .body {
      margin-top:8px;
      display:none;
    }
    #countryToggle:checked + .toggle-btn + .body {
      display:block;
    }
  </style>

 <div id="countryCard">
    <input type="checkbox" id="countryToggle">
    
    <label class="toggle-btn" for="countryToggle">
      <span class="title">üåê Country Mentions (Pie Chart)</span>
      <span class="chev">‚ñ∏</span>
    </label>

    <div class="body" id="countryBody">
      <canvas id="countryPie" width="300" height="300"></canvas>
      <div id="countryDetails"></div>
    </div>
  </div>
</div>
-->
      <table id="newsTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Topic score</th>
        <th>Highlight in this article</th> 
    <!--<th>Confidence Rate</th>  -->
        <th>Potential impact </th>
        <th>ELI5 what's about</th>
        <th>PubDate</th>
        <th>Media Source</th>
        <th><i>Confidence%</i></th>
         
      </tr>
    </thead>
    <tbody id="newsTableBody">
      <tr><td colspan="3">Loading data...</td></tr>
    </tbody>
  </table>
   <section style="margin-top: 15px; padding: 10px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
  <h4 style="margin-bottom: 10px;">üìò Text review</h4>
  <ul style="line-height: 1.6;">
    <li> GPT4o-mini is prompted to summerise and give examples for the related topic.
    <strong>Note</strong> 
This output is generated by GPT4o-mini.</li>
  </ul>
   </section>
    <!-- Trend Summary Section -->
<!-- 
  <section id="weeklyTrend" style="margin-top: 30px; padding: 16px; background: #f4f4f4; border-radius: 6px;">
  <h4> Weekly Trend Summary</h4>
  <div id="trendSummary">Loading trend...</div>
  <ul id="dailySummaries"></ul>
</section>
-->

      
      <script>
    let newsData = [];
   // let ascending = false;

   /* const countries = [
      'USA', 'Alaska','China', 'Iran','Japan', 'Korea', 'Vietnam', 'Togo','Mali','Africa','Congo','Gabon',
      'France', 'Germany', 'India', 'Brazil', 'Gaza', 'UK', 'Pakistan','Indonesia', 'Bangladesh',
      'Yemen', 'Syria','US','Algeria','Ireland','Dubai','UAE', 'Spain', 'Italy','Somali','Laos','Nepal',
       'Bulgary', 'Turkey', 'Greece', 'Israel', 'Palestine', 'Ukraine', 'Russia', 'Thailand', 'Cambodia','Colombia','Mexico',
       'Morocco','Tunisia','Jordan','Lebanon', 'Libya','Egypt','Afghanistan','Kashmir',
       'Qatar', 'Saudi Arabia','Portugal', 'New York','Chicago','Washington', 'California', 'Texas'
    ];
    */

    function togglePreview(index) {
      const row = document.getElementById(`preview-${index}`);
      if (row) {
        row.style.display = row.style.display === "table-row" ? "none" : "table-row";
      }
    }

    function renderTable(data) {
      const tableBody = document.getElementById("newsTableBody");
      tableBody.innerHTML = '';

      data.forEach((item, i) => {
        const row = document.createElement("tr");
        const emotionLabel = typeof item.emotion === 'string'? item.emotion.charAt(0).toUpperCase() + item.emotion.slice(1): '‚Äî';
        const reasonlabel = typeof item.reason === 'string'? item.reason.charAt(0).toUpperCase() + item.reason.slice(1): '‚Äî';
        const aisummarylabel = typeof item.aisummary === 'string'? item.aisummary.charAt(0).toUpperCase() + item.aisummary.slice(1): '‚Äî'
         
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>
            <a href="${item.link}" target="_blank">${item.title}</a><br>
            <button class="btn-preview" onclick="togglePreview(${i})">üîç Description </button>
          </td>
          <td>${item.sentimentScore.toFixed(2)}</td>
          <td>${emotionLabel}</td>
          <td>${reasonlabel}</td>
          <td>${aisummarylabel}</td> 
          <td>${new Date(item.pubDate).toLocaleString()}</td>
          <td>${item.source || 'Unknown'}</td>
          <td>${item.confidence !== undefined ? (item.confidence ).toFixed(0) + '%' : '‚Äî'}</td>
          
        `;

         
        const preview = document.createElement("tr");
        preview.id = `preview-${i}`;
        preview.className = 'preview-row';
        preview.innerHTML = `
          <td colspan="8">
            <div class="preview-content">
              <strong>Summary:</strong><br>${item.description || "No description available."}
            </div>
          </td>
        `;

        tableBody.appendChild(row);
        tableBody.appendChild(preview);
      });
    }


 /*    
    function getCountryStats(data) {
      const stats = {};
      data.forEach(item => {
        countries.forEach(country => {
          const regex = new RegExp(`\\b${country}\\b`, 'i');
          if (regex.test(item.title + ' ' + item.description)) {
            if (!stats[country]) stats[country] = { count: 0, totalScore: 0 };
            stats[country].count += 1;
            stats[country].totalScore += item.sentimentScore;
          }
        });
      });
      return Object.entries(stats)
        .map(([country, { count, totalScore }]) => ({
          country,
          count,
          avgScore: parseFloat((totalScore / count).toFixed(2))
        }))
        .sort((a, b) => b.count - a.count);
    }

    function renderCountryChart(stats) {
      const ctx = document.getElementById('countryPie').getContext('2d');
      const labels = stats.map(s => s.country);
      const data = stats.map(s => s.count);

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            label: 'Mentions by Country',
            data
          }]
        },
        options: {
          onClick: (e, elements) => {
            if (elements.length > 0) {
              const index = elements[0].index;
              const selected = stats[index];
              document.getElementById('countryDetails').innerHTML = `
                <strong>${selected.country}</strong><br>
                Mentions: ${selected.count}<br>
                Avg Score: ${selected.avgScore > 0 ? '+' : ''}${selected.avgScore.toFixed(2)}
              `;
            }
          }
        }
      });
    }
*/

     
     /* function generateWordCloud(data) {
  const wordCounts = {};

  data.forEach(item => {
    const text = `${item.title} ${item.description}`.toLowerCase();
    const words = text.match(/\b[a-z]{4,}\b/g); // only words with 4+ letters
    if (!words) return;

    words.forEach(word => {
      if (wordCounts[word]) wordCounts[word]++;
      else wordCounts[word] = 1;
    });
  });

  const entries = Object.entries(wordCounts)
    .filter(([word, count]) => count > 1) // filter out single-use words
    .sort((a, b) => b[1] - a[1])
    .slice(0, 100); // top 100 terms

  WordCloud(document.getElementById('wordCloud'), {
    list: entries,
    gridSize: 8,
    weightFactor: 3,
    fontFamily: 'Arial',
    color: 'random-dark',
    backgroundColor: '#f4f7fa'
  });
}
*/
     
    async function fetchData() {
     //  document.getElementById("loading").style.display = 'block';
      const tableBody = document.getElementById("newsTableBody");
      document.getElementById("loading").style.display = 'flex';

      try {
        
        const res = await fetch("https://subgrade-1.onrender.com/bbc/rss");
        newsData = await res.json();
        renderTable(newsData);
       // const countryStats = getCountryStats(newsData);
       // renderCountryChart(countryStats);
         // generateWordCloud(newsData);

      } catch (error) {
        tableBody.innerHTML = '<tr><td colspan="8">‚ùå Failed to load news data.</td></tr>';
        console.error("Error:", error);
      }
     document.getElementById("loading").style.display = 'none';  
    }

 // function summary 
  async function loadSummary() {
  const summaryBox = document.getElementById("trendSummary");
  const dailyList = document.getElementById("dailySummaries");

  try {
    // Fetch overall trend summary
    const res = await fetch("https://subgrade-1.onrender.com/bbc/trends/gpt");
    const data = await res.json();

    summaryBox.innerHTML = `<p>${data.trend}</p>`;

    if (Array.isArray(data.summaries)) {
      dailyList.innerHTML = data.summaries
        .map(s => `<li><strong>${s.date}:</strong> ${s.summary}</li>`)
        .join("");
    } else {
      dailyList.innerHTML = "<li>No daily summaries available.</li>";
    }

  } catch (err) {
    summaryBox.textContent = "‚ùå Could not load trend summary.";
    dailyList.innerHTML = "<li>Error loading summaries.</li>";
    console.error("Trend fetch error:", err);
  }
}

  // daily/weekly summary
  async function fetchTrend() {
  const summaryBox = document.getElementById("trendSummary");
  const dailyList = document.getElementById("dailySummaries");

  try {
    const res = await fetch("https://subgrade-1.onrender.com/bbc/trends");
    const data = await res.json();

    summaryBox.innerHTML = `<p>${data.trend || 'No trend summary available.'}</p>`;

    if (Array.isArray(data.summaries)) {
      dailyList.innerHTML = data.summaries
        .map(s => `<li><strong>${s.date}:</strong> ${s.summary}</li>`)
        .join("");
    } else {
      dailyList.innerHTML = "<li>No daily summaries available.</li>";
    }

  } catch (err) {
    summaryBox.textContent = "‚ùå Could not load trend summary.";
    dailyList.innerHTML = "<li>Error loading summaries.</li>";
    console.error("Trend fetch error:", err);
  }
}
//

     
let sortMode = "date"; // or "score"
let ascending = true;

const comparator = (a, b) => {
  if (sortMode === "date") {
    const ta = Date.parse(a.pubDate);
    const tb = Date.parse(b.pubDate);
    return ascending ? ta - tb : tb - ta;
  } else {
    const sa = Number(a.sentimentScore ?? 0);
    const sb = Number(b.sentimentScore ?? 0);
    return ascending ? sa - sb : sb - sa;
  }
};

document.getElementById("toggleSort").addEventListener("click", () => {
  // date ‚Üë ‚Üí date ‚Üì ‚Üí score ‚Üë ‚Üí score ‚Üì ‚Üí back to date ‚Üë
  if (sortMode === "date" && ascending) {
    ascending = false;
  } else if (sortMode === "date" && !ascending) {
    sortMode = "score";
    ascending = true;
  } else if (sortMode === "score" && ascending) {
    ascending = false;
  } else {
    sortMode = "date";
    ascending = true;
  }

  const sorted = [...newsData].sort(comparator);

  document.getElementById("toggleSort").innerText =
    ascending
      ? (sortMode === "date" ? "‚¨ÜÔ∏è Sort by Date" : "‚¨ÜÔ∏è Sort by Score")
      : (sortMode === "date" ? "‚¨áÔ∏è Sort by Date" : "‚¨áÔ∏è Sort by Score");

  renderTable(sorted);
});


let isDataReady = false;
let summaryLoaded = false;
//let summaryContent = false;

document.addEventListener('DOMContentLoaded', () => {
  fetchData().then(() => {
    isDataReady = true;

    // Enable manual click trigger
    const summary = document.getElementById('summary');
    const summaryContent = document.getElementById('summary-content');

    if (summary && summaryContent) {
      summary.style.cursor = 'pointer';
      summary.style.opacity = '1';
      summaryContent.textContent = 'Click to load summary';

      // üëâ Only call fetchTrend() on click, after fetchData is done
      summary.addEventListener('click', fetchTrend);
    }

    // to load trend immediately after fetchData finishes
    // fetchTrend();
  });
});
//

  document.getElementById('summary').addEventListener('click', async () => {
    if (!isDataReady || summaryLoaded) return;

    const content = document.getElementById('summary-content');
    content.textContent = "Loading summary...";

    await loadSummary();
    summaryLoaded = true;
  });



      </script>
   
 <!-- Click C on the keyboard -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.addEventListener('keydown', e => {
    if (e.key.toLowerCase() === 'c') {
      const catCount = document.querySelectorAll('.falling-cat').length;
      if (catCount < 2) { // Limit 
        const cat = document.createElement('div');
        cat.classList.add('falling-cat');
        cat.textContent = '(*‚Äø*)„Éé Welcome, this is just a poke...(‚óï‚Äø‚óï)„Å§';
        cat.style.position = 'fixed';
        cat.style.left = Math.random() * window.innerWidth + 'px';
        cat.style.top = '-50px';
        cat.style.fontSize = '2em';
        cat.style.transition = 'top 3s linear';
        document.body.appendChild(cat);
        setTimeout(() => {
          cat.style.top = window.innerHeight + 'px';
        }, 10); 
        setTimeout(() => cat.remove(), 3000);
      }
    }
  });
});

</script>

<style>
@keyframes fall {
  to { transform: translateY(100vh); opacity: 0; }
}
</style>

      
   <!-- Hidden clickable pixel -->
<div onclick="alert('I carry no badge, yet I‚Äôm great at directions;\nI‚Äôm the compass, not the captain.\n\nI set the stage, you play the scene.\n\nI bring the map, you choose the journey.\n\nI can prompt, but you perform. ^_^')" 
     style="position: absolute; bottom: 10; left: 10; width: 50px; height: 50px; cursor: pointer;"></div>


</body>
</html>      


                    
    
