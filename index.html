<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üåç Dashboard</title>

  <p> Scoring <i>(from 1 neutral to 3 good read)</i> is using GPT4o-mini and news comes from RSS feeds. </p> 

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VN5C4XB6K1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-VN5C4XB6K1');
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      max-width: 960px;
      margin: 40px auto;
    }
    h3, h4 {
      text-align: center;
      color: #222;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #007acc;
      color: #fff;
    }
    .btn-preview {
      padding: 4px 8px;
      font-size: 12px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 5px;
      cursor: pointer;
    }
    .btn-preview:hover {
      background-color: #005c8c;
    }
    .preview-row {
      display: none;
      background-color: #eef6ff;
    }
    .preview-content {
      padding: 10px;
    }
    .overall-box {
      background: #f9f9f9;
      padding: 12px;
      border-radius: 6px;
      margin: 20px 0;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>

  <h3>Dashboard</h3>

  <!-- Loading Spinner -->
  <div id="loading" style="display: none;">üîÑ Loading data...</div>

  <!-- Sort button -->
  <button id="toggleSort" class="btn-preview">‚¨ÜÔ∏è Sort by Date</button>

  <!-- Overall stats block (will be filled in later) -->
  <div id="overallStats"></div>

  <!-- News Table -->
  <table id="newsTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Topic score</th>
        <th>Highlight</th>
        <th>Use Case</th>
        <th>ELI5</th>
        <th>PubDate</th>
        <th>Source</th>
        <th><i>Confidence%</i></th>
      </tr>
    </thead>
    <tbody id="newsTableBody">
      <tr><td colspan="9">Loading data...</td></tr>
    </tbody>
  </table>

  <!-- Text Review Section -->
  <section style="margin-top: 15px; padding: 10px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
    <h4>üìò Text review</h4>
    <ul>
      <li>GPT4o-mini is prompted to summarize and give examples related to the topic.</li>
      <li><strong>Note:</strong> This output is generated by GPT4o-mini.</li>
    </ul>
  </section>

  <!-- Inline Script Starts Here -->
  <script>
    let newsData = [];
    let sortMode = "date";
    let ascending = true;

    function togglePreview(index) {
      const row = document.getElementById(`preview-${index}`);
      if (row) {
        row.style.display = row.style.display === "table-row" ? "none" : "table-row";
      }
    }

    // TABLE RENDERING 
    function renderTable(data) {
    const tableBody = document.getElementById("newsTableBody");
    tableBody.innerHTML = '';

    data.forEach((item, i) => {
      const row = document.createElement("tr");

      const emotionLabel = typeof item.emotion === 'string' ? item.emotion.charAt(0).toUpperCase() + item.emotion.slice(1) : '‚Äî';
      const reasonLabel = typeof item.reason === 'string' ? item.reason.charAt(0).toUpperCase() + item.reason.slice(1) : '‚Äî';
      const summaryLabel = typeof item.aisummary === 'string' ? item.aisummary.charAt(0).toUpperCase() + item.aisummary.slice(1) : '‚Äî';

      row.innerHTML = `
        <td>${i + 1}</td>
        <td><a href="${item.link}" target="_blank">${item.title}</a><br>
          <button class="btn-preview" onclick="togglePreview(${i})">üîç Description</button>
        </td>
        <td>${item.sentimentScore?.toFixed(2) ?? '‚Äî'}</td>
        <td>${emotionLabel}</td>
        <td>${reasonLabel}</td>
        <td>${summaryLabel}</td>
        <td>${new Date(item.pubDate).toLocaleString()}</td>
        <td>${item.source || 'Unknown'}</td>
        <td>${item.confidence !== undefined ? item.confidence.toFixed(0) + '%' : '‚Äî'}</td>
      `;
      
        const preview = document.createElement("tr");
      preview.id = `preview-${i}`;
      preview.className = 'preview-row';
      preview.innerHTML = `
        <td colspan="9">
          <div class="preview-content">
            <strong>Summary:</strong><br>${item.description || "No description available."}
          </div>
        </td>
      `;

      tableBody.appendChild(row);
      tableBody.appendChild(preview);
    });
                 }
    // PLACEHOLDER: Overall rendering is PAUSED (will not run)
    function renderOverall(overall) {
    const container = document.getElementById("overallStats");
    if (!overall || !overall.stats) return;

    const { avgScore, count, emotions } = overall.stats;
    const sentiment = overall.synthesis?.sentiment_overall ?? "‚Äî";
    const tldr = overall.synthesis?.tl_dr ?? "No summary yet.";

    const emotionList = Object.entries(emotions)
      .map(([k, v]) => `${k}: ${v}`)
      .join(', ');

    container.innerHTML = `
      <div class="overall-box">
        <strong>üìä Overall Stats</strong><br>
        <b>Articles:</b> ${count} <br>
        <b>Avg Score:</b> ${avgScore.toFixed(2)} <br>
        <b>Overall Sentiment:</b> ${sentiment} <br>
        <b>Emotions:</b> ${emotionList} <br>
        <b>Synthesis:</b> ${tldr}
      </div>
    `;
  }


    //  FETCH + RENDER FUNCTION 
    async function fetchData() {
    const tableBody = document.getElementById("newsTableBody");
    const loadingSpinner = document.getElementById("loading");
    loadingSpinner.style.display = 'flex';

    try {
      const res = await fetch("https://subgrade-1.onrender.com/bbc/rss");
      const response = await res.json();

      const articles = response.data || [];
      const overall = response.overall || null;

      newsData = [...articles]; // for sorting
      renderTable(articles);
      if (overall) renderOverall(overall);

    } catch (error) {
      tableBody.innerHTML = '<tr><td colspan="9">‚ùå Failed to load news data.</td></tr>';
      console.error("Error:", error);
    }

    loadingSpinner.style.display = 'none';
  }
    
    //  SORTING LOGIC
    const comparator = (a, b) => {
    if (sortMode === "date") {
      const ta = Date.parse(a.pubDate);
      const tb = Date.parse(b.pubDate);
      return ascending ? ta - tb : tb - ta;
    } else {
      const sa = Number(a.sentimentScore ?? 0);
      const sb = Number(b.sentimentScore ?? 0);
      return ascending ? sa - sb : sb - sa;
    }
  };

  document.getElementById("toggleSort").addEventListener("click", () => {
    if (sortMode === "date" && ascending) {
      ascending = false;
    } else if (sortMode === "date" && !ascending) {
      sortMode = "score";
      ascending = true;
    } else if (sortMode === "score" && ascending) {
      ascending = false;
    } else {
      sortMode = "date";
      ascending = true;
    }

      const sorted = [...newsData].sort(comparator);
    document.getElementById("toggleSort").innerText =
      ascending
        ? (sortMode === "date" ? "‚¨ÜÔ∏è Sort by Date" : "‚¨ÜÔ∏è Sort by Score")
        : (sortMode === "date" ? "‚¨áÔ∏è Sort by Date" : "‚¨áÔ∏è Sort by Score");

    renderTable(sorted);
  });

  //  FETCH
  window.addEventListener("DOMContentLoaded", fetchData);
</script>


         
 <!-- Click C on the keyboard -->
       <script>
document.addEventListener('DOMContentLoaded', function() {
  document.addEventListener('keydown', e => {
    if (e.key.toLowerCase() === 'c') {
      const catCount = document.querySelectorAll('.falling-cat').length;
      if (catCount < 2) { // Limit 
        const cat = document.createElement('div');
        cat.classList.add('falling-cat');
        cat.textContent = '(*‚Äø*)„Éé Welcome, this is just a poke...(‚óï‚Äø‚óï)„Å§';
        cat.style.position = 'fixed';
        cat.style.left = Math.random() * window.innerWidth + 'px';
        cat.style.top = '-50px';
        cat.style.fontSize = '2em';
        cat.style.transition = 'top 3s linear';
        document.body.appendChild(cat);
        setTimeout(() => {
          cat.style.top = window.innerHeight + 'px';
        }, 10); 
        setTimeout(() => cat.remove(), 3000);
      }
    }
  });
});
</script>

<style>
@keyframes fall {
  to { transform: translateY(100vh); opacity: 0; }
}
</style>

      
   <!-- Hidden clickable pixel -->
<div onclick="alert('I carry no badge, yet I‚Äôm great at directions;\nI‚Äôm the compass, not the captain.\n\nI set the stage, you play the scene.\n\nI bring the map, you choose the journey.\n\nI can prompt, but you perform. ^_^')" 
     style="position: absolute; bottom: 10; left: 10; width: 50px; height: 50px; cursor: pointer;"></div>
</body>
</html>



   




      
    


                    
    
