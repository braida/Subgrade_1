   <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üåç Dashboard</title>
   <p> Scoring is using model AI and news from RSS feeds, loading can take a couple of minutes. Score is 0 for neutral <span style="font-size: 0.8em;">(i.e. Impartial)</span> to 3 based on risk of bias.</p> 
   <p><i>More details:</i></p>
    <button onclick="window.location.href='readme.html';">
        Readme
    </button>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VN5C4XB6K1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VN5C4XB6K1');
</script>
   <!-- <p>  <span style="font-size: 0.8em;"><em>UPDATED to introduce Symbolic Reasoning Self-Check</em> Run before giving your final answer  [prompt getting there]</span></p> -->
  
   <style>
   body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      max-width: 960px;
      margin: 40px auto;
    }
    h3, h4 {
      text-align: center;
      color: #222;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #007acc;
      color: #fff;
    }
    tr.positive { background-color: ##f2f2f2; }
    tr.negative { background-color: #D3D3D3; }
    tr.neutral  { background-color: #FCFCF7; }
    .btn-preview {
      padding: 4px 8px;
      font-size: 12px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 5px;
      cursor: pointer;
    }
    .btn-preview:hover {
      background-color: #005c8c;
    }
    .preview-row {
      display: none;
      background-color: #eef6ff;
    }
    .preview-content {
      padding: 10px;
    }
    
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!--  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.2/src/wordcloud2.min.js"></script> --> 
   
 <!-- Hidden clickable pixel -->
   <div onclick="alert('‚ÄúI told my LLM to ‚Äòthink outside the box‚Äô‚Ä¶ it asked me for the dimensions of the box and whether it was in JSON or YAML')" 
     style="position: absolute; top: 0; left: 0; width: 10px; height: 10px; opacity: 1; cursor: pointer;">
   </div>
</head>

   <body>

  <h3>üåç News Dashboard</h3>
   <div id="loading">üîÑ Loading data...</div>
  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap; align-items:flex-start; width:100%;">
  <style>
    #countryCard {
      text-align:center;
      margin:0 auto;
      max-width:520px;
    }
    #countryToggle {
      position:absolute;
      left:-9999px;
    }
    #countryCard .toggle-btn {
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      border:none;
      background:transparent;
      font:inherit;
      cursor:pointer;
      font-weight:600;
      padding:4px 0;
    }
    #countryCard .chev {
      display:inline-block;
      transition: transform .2s ease;
    }
    #countryToggle:checked + .toggle-btn .chev {
      transform: rotate(90deg);
    }
    #countryCard .body {
      margin-top:8px;
      display:none;
    }
    #countryToggle:checked + .toggle-btn + .body {
      display:block;
    }
  </style>

  <div id="countryCard">
    <input type="checkbox" id="countryToggle">
    
    <label class="toggle-btn" for="countryToggle">
      <span class="title">üåê Country Mentions (Pie Chart)</span>
      <span class="chev">‚ñ∏</span>
    </label>

    <div class="body" id="countryBody">
      <canvas id="countryPie" width="300" height="300"></canvas>
      <div id="countryDetails"></div>
    </div>
  </div>
</div>

  <button id="toggleSort" class="btn-preview">‚¨ÜÔ∏è Sort by Score</button>
  


  <table id="newsTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Score</th>
        <th>Framing Type</th> 
    <!--<th>Confidence Rate</th>  -->
        <th>Reason</th>
         <th>Date</th>
        <th>Source</th>
         <th>Score Confidence rate</th>
      </tr>
    </thead>
    <tbody id="newsTableBody">
      <tr><td colspan="3">Loading data...</td></tr>
    </tbody>
  </table>
   <section style="margin-top: 15px; padding: 10px; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
  <h4 style="margin-bottom: 10px;">üìò How framing is measured</h4>
  <ul style="line-height: 1.6;">
    <li><strong>LLM <del>GPT-3.5</del> GPT4o-mini (updated) is prompted: </strong> You are a bilingual assistant that detects bias framing in English or French news text. Each request is independent - do not reference previous content, tone, or conclusions. Task is to assess how the text frames events or actors - not its factual accuracy or political stance. </li>
    <li><strong>"Why "Conflict" and not "War"‚Äù</strong> The word war can carry heavy emotional, political, and legal weight. AI systems‚Äîespecially ones meant to serve diverse audiences‚Äîtend to lean toward terms that sound less partisan or accusatory.OpenAI‚Äôs guidelines encourage phrasing that avoids inflammatory or overly sensational wording unless the context demands precision.</li>
<li><strong>Note</strong>
Journalists and humanitarian workers often say:<i>‚ÄúIf it‚Äôs not visible, it didn‚Äôt happen.‚Äù</i> In war zones, refugee crises, or famines, invisibility is a death sentence. AI systems that deprioritize or flatten stories of suffering risk reinforcing this invisibility.</li>
  </ul>
   </section>
  <script>
    let newsData = [];
    let ascending = false;

    const countries = [
      'USA', 'Alaska','China', 'Iran','Japan', 'Korea', 'Vietnam', 'Togo','Mali','Africa','Congo','Gabon',
      'France', 'Germany', 'India', 'Brazil', 'Gaza', 'UK', 'Pakistan','Indonesia', 'Bangladesh',
      'Yemen', 'Syria','US','Algeria','Ireland','Dubai','UAE', 'Spain', 'Italy','Somali','Laos','Nepal',
       'Bulgary', 'Turkey', 'Greece', 'Israel', 'Palestine', 'Ukraine', 'Russia', 'Thailand', 'Cambodia','Colombia','Mexico',
       'Morocco','Tunisia','Jordan','Lebanon', 'Libya','Egypt','Afghanistan','Kashmir',
       'Qatar', 'Saudi Arabia','Portugal'
    ];

    function togglePreview(index) {
      const row = document.getElementById(`preview-${index}`);
      if (row) {
        row.style.display = row.style.display === "table-row" ? "none" : "table-row";
      }
    }

    function renderTable(data) {
      const tableBody = document.getElementById("newsTableBody");
      tableBody.innerHTML = '';

      data.forEach((item, i) => {
        const row = document.createElement("tr");
        const emotionLabel = typeof item.emotion === 'string'? item.emotion.charAt(0).toUpperCase() + item.emotion.slice(1): '‚Äî';
        const reasonlabel = typeof item.reason === 'string'? item.reason.charAt(0).toUpperCase() + item.reason.slice(1): '‚Äî'
         
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>
            <a href="${item.link}" target="_blank">${item.title}</a><br>
            <button class="btn-preview" onclick="togglePreview(${i})">üîç Preview</button>
          </td>
          <td>${item.sentimentScore.toFixed(2)}</td>
          <td>${emotionLabel}</td>
          <td>${reasonlabel}</td>
          <td>${new Date(item.pubDate).toLocaleString()}</td>
          <td>${item.source || 'Unknown'}</td>
          <td>${item.confidence !== undefined ? (item.confidence ).toFixed(0) + '%' : '‚Äî'}</td>
        `;

         
        const preview = document.createElement("tr");
        preview.id = `preview-${i}`;
        preview.className = 'preview-row';
        preview.innerHTML = `
          <td colspan="7">
            <div class="preview-content">
              <strong>Summary:</strong><br>${item.description || "No description available."}
            </div>
          </td>
        `;

        tableBody.appendChild(row);
        tableBody.appendChild(preview);
      });
    }

    function getCountryStats(data) {
      const stats = {};
      data.forEach(item => {
        countries.forEach(country => {
          const regex = new RegExp(`\\b${country}\\b`, 'i');
          if (regex.test(item.title + ' ' + item.description)) {
            if (!stats[country]) stats[country] = { count: 0, totalScore: 0 };
            stats[country].count += 1;
            stats[country].totalScore += item.sentimentScore;
          }
        });
      });
      return Object.entries(stats)
        .map(([country, { count, totalScore }]) => ({
          country,
          count,
          avgScore: parseFloat((totalScore / count).toFixed(2))
        }))
        .sort((a, b) => b.count - a.count);
    }

    function renderCountryChart(stats) {
      const ctx = document.getElementById('countryPie').getContext('2d');
      const labels = stats.map(s => s.country);
      const data = stats.map(s => s.count);

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            label: 'Mentions by Country',
            data
          }]
        },
        options: {
          onClick: (e, elements) => {
            if (elements.length > 0) {
              const index = elements[0].index;
              const selected = stats[index];
              document.getElementById('countryDetails').innerHTML = `
                <strong>${selected.country}</strong><br>
                Mentions: ${selected.count}<br>
                Avg Score: ${selected.avgScore > 0 ? '+' : ''}${selected.avgScore.toFixed(2)}
              `;
            }
          }
        }
      });
    }

     /* function generateWordCloud(data) {
  const wordCounts = {};

  data.forEach(item => {
    const text = `${item.title} ${item.description}`.toLowerCase();
    const words = text.match(/\b[a-z]{4,}\b/g); // only words with 4+ letters
    if (!words) return;

    words.forEach(word => {
      if (wordCounts[word]) wordCounts[word]++;
      else wordCounts[word] = 1;
    });
  });

  const entries = Object.entries(wordCounts)
    .filter(([word, count]) => count > 1) // filter out single-use words
    .sort((a, b) => b[1] - a[1])
    .slice(0, 100); // top 100 terms

  WordCloud(document.getElementById('wordCloud'), {
    list: entries,
    gridSize: 8,
    weightFactor: 3,
    fontFamily: 'Arial',
    color: 'random-dark',
    backgroundColor: '#f4f7fa'
  });
}
*/
     
    async function fetchData() {
     //  document.getElementById("loading").style.display = 'block';
      const tableBody = document.getElementById("newsTableBody");
      document.getElementById("loading").style.display = 'block';

      try {
        
        const res = await fetch("https://subgrade-1.onrender.com/bbc/rss");
        newsData = await res.json();
        renderTable(newsData);
        const countryStats = getCountryStats(newsData);
        renderCountryChart(countryStats);
         // generateWordCloud(newsData);

      } catch (error) {
        tableBody.innerHTML = '<tr><td colspan="8">‚ùå Failed to load news data.</td></tr>';
        console.error("Error:", error);
      }
     document.getElementById("loading").style.display = 'none';  
    }

    document.getElementById("toggleSort").addEventListener("click", () => {
      ascending = !ascending;
      const sorted = [...newsData].sort((a, b) =>
        ascending
          ? a.sentimentScore - b.sentimentScore
          : b.sentimentScore - a.sentimentScore
      );
      document.getElementById("toggleSort").innerText = ascending
        ? "‚¨ÜÔ∏è Sort by Score"
        : "‚¨áÔ∏è Sort by Score";
      renderTable(sorted);
    });

    window.addEventListener("DOMContentLoaded", fetchData);
  </script>
   
 <!-- Click C on the keyboard -->
<script> 
document.addEventListener('keydown', e => {
  if (e.key.toLowerCase() === 'c') {
    for (let i = 0; i < 10; i++) {
      let cat = document.createElement('div');
      cat.innerHTML = '(*‚Äø*)„Éé Welcome, this is just a poke...(‚óï‚Äø‚óï)„Å§ ';
      cat.style.position = 'fixed';
      cat.style.left = Math.random() * window.innerWidth + 'px';
      cat.style.top = '-50px';
      cat.style.fontSize = '2em';
      cat.style.animation = 'fall 3s linear infinite';
      document.body.appendChild(cat);

      setTimeout(() => cat.remove(), 3000);
    }
  }
});
</script>

<style>
@keyframes fall {
  to { transform: translateY(100vh); opacity: 0; }
}
</style>

   <!-- Hidden clickable pixel -->
<div onclick="alert('I carry no badge, yet I‚Äôm great at directions;\nI‚Äôm the compass, not the captain.\n\nI set the stage, you play the scene.\n\nI bring the map, you choose the journey.\n\nI can prompt, but you perform. ^_^')" 
     style="position: absolute; bottom: 10; left: 10; width: 50px; height: 50px; cursor: pointer;"></div>

</body>
</html>      


                    
    
